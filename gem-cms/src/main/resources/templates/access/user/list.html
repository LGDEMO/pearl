<!DOCTYPE html>
<html lang="zh-cn" class="fullscreen-bg" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html"; charset="utf-8" />
    <title></title>
    <div th:replace="common/links::common_links"></div>
    <div th:replace="common/links::font_links"></div>
    <div th:replace="common/links::ztree_links"></div>
    <div th:replace="common/links::table_list_links"></div>
    <style>
        .notice_nav a:nth-child(3){border-top-right-radius: 0;border-bottom-right-radius:0}
        .notice_nav a:nth-child(4){border-top-right-radius: 4px;border-bottom-right-radius: 4px}
        th{text-align: center !important;height: 34px;color: #FFF }
    </style>
</head>
<body style="background-color: #ecf0f5;font-family: 微软雅黑;color: #475059;min-width: 550px;overflow: auto">
<div class="news_main">
    <div id="dept_tree" class="l_left news_left" style="display: none">
        <h6>部门目录</h6>
        <div class="tree_left_top" style="height: 90%;overflow: auto">
            <div class=" order_ztree l_left organize_ztree" style="width: 100%">
                <p><ul id="leftTree" class="ztree"  style=" overflow:auto;margin-left: 20px"></ul></p>
            </div>
        </div>
    </div>
    <div id="dept_user" class="l_left news_right">
        <div class="notice_main">
            <div class="notice_check">
                <div class="btn-group l_left"  style="margin-right: 4px">
                    <button type="button" class="btn btn-default" onclick="switchView('dept>user')">按部门查询</button>
                    <button type="button" class="btn btn-default">按角色查询</button>
                    <button type="button" class="btn btn-default change" style="height: 30px;line-height: 30px;padding: 0 12px !important;font-size: 12px">选择条件</button>
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="height: 30px;line-height: 30px">
                        <span class="caret"></span>
                        <span class="sr-only"></span>
                    </button>
                    <ul style="min-width: 245px;!important;" class="dropdown-menu" >
                        <li>用户名</li>
                        <li>手机号</li>
                        <li>电子邮箱</li>
                    </ul>
                </div>
                <div class="l_left">
                    <input type="text" class="find_input">
                </div>
                <button class="check_btn" onclick="queryData()">查询</button>
                <div class="notice_nav r_right">
                    <a class="btn btn-default" onclick="addView()"><span class="glyphicon glyphicon-plus"></span>新增</a>
                    <a class="btn btn-default" onclick="deleteBatch()"><span class="glyphicon glyphicon-remove"></span>删除</a>
                    <a class="btn btn-default" onclick="addRole()"><span class="glyphicon glyphicon-pencil"></span>编辑</a>
                    <a class="btn btn-default" onclick="warrant()"><span class="glyphicon glyphicon-tag"></span>重置密码</a>
                </div>
                <div class="clear"></div>
            </div>
            <table id="table" class="table_style" style="margin: 0 auto" > </table>
        </div>
    </div>
    <div class="clear"></div>

</div>

<div th:replace="common/links::common_script"></div>
<div th:replace="common/links::ztree_script"></div>
<div th:replace="common/links::table_script"></div>
<script type="text/javascript" th:src="@{/static/access/js/custom/depttree.js}"></script>

<script>
    $(function(){
        console.log("==12345")
        table();
        change();
        $("#dept_user").removeClass("l_left news_right")
    });

    function table() {
        $('#table').bootstrapTable({
            method: "get",
            striped: true,  //是否显示行间隔色
            sortable: true, //是否启用排序
            sortOrder: "asc",
            url: "pageByParams",
            dataType: "json",
            contentType: "application/x-www-form-urlencoded",
            queryParams:null,
            //得到查询的参数
            queryParams: function (params) {
                //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
                var query_params = {
                    rows: params.limit,                         //页面大小
                    page: (params.offset / params.limit) + 1,   //页码
                    sort: params.sort,      //排序列名
                    sortOrder: params.order, //排位命令（desc，asc）

                    //查询框中的参数传递给后台
                    search_kw: $('#search-keyword').val(), // 请求时向服务端传递的参数
                };
                //return query_params;
            },
            pagination: true, //分页
            // sidePagination: "server",//分页方式
            pageNumber: 1,//初始化加载第一页，默认第一页
            pageSize: 10,//每页的记录行数（*）
            pageList: [10, 25, 50, 100],
            clickToSelect: true,
            height: 30,     //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度#}
            // showToggle: true,   //是否显示详细视图和列表视图的切换按钮
            // singleSelect: true, //开启单选,想要获取被选中的行数据必须要有该参数

            columns: [
                {
                    checkbox: "true",
                    field: 'check',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '用户名',
                    field: 'username',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '工号',
                    field: 'worknum',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '员工姓名',
                    field: 'realname',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '手机号',
                    field: 'phone',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '电子邮箱',
                    field: 'email',
                    align: 'center',
                    valign: 'middle'
                },
                 {
                    field: 'operate',
                    title: '操作',
                    width: 220,
                    align: 'center',
                    events: "operateEvents",
                    formatter: operateFormatter
                }
            ]
        });
    }

    function operateFormatter(value, row, index) {
        return [
            '<button type="button" id="btn_detail" class="btn btn-default btn-xs" style="margin-right: 5px;">详情</button>',
            '<button type="button" id="btn_edit" class="btn btn-primary btn-xs" style="margin-right: 5px;">编辑</button>',
            '<button type="button" id="btn_del" class="btn btn-danger btn-xs" style="margin-right: 5px;">删除</button>'
        ].join('');

    }
    window.operateEvents = {
        'click #btn_detail': function (e, value, row, index) {
            alert("您选中了用户:"+JSON.stringify(row));
        },
        'click #btn_edit': function (e, value, row, index) {
            editView(row.id);
        },
        'click #btn_del': function (e, value, row, index) {
            deleteData(row.id);
        }
    };


    function change(){
        $(".dropdown-menu>li").click(function(){
            $(".change").html($(this).html())
        })
    }

    function addView(){
        layer.open({
            type: 2,
            title: '添加新用户',
            shadeClose: true,
            shade: 0.5,
            skin: 'layui-layer-rim',
            closeBtn:1,
            area: ['750px', '574px'],
            content: 'add.html',
            end:function () {
                $('#table').bootstrapTable("refresh");
            }
        });
    }

    function editView(id){
        layer.open({
            type: 2,
            title: '编辑用户',
            shadeClose: true,
            shade: 0.5,
            skin: 'layui-layer-rim',
            closeBtn:1,
            area: ['750px', '574px'],
            content: 'edit.html?id='+id,
            end:function () {
                $('#table').bootstrapTable("refresh");
            }
        });
    }



    function deleteData(id) {
        layer.confirm('确定删除吗？哥们？', {
            btn: ['确定','再想想'] //按钮
        }, function(){
            $.ajax({
                type: "post",
                url: "delete/"+id,
                // data: JSON.stringify($('#form').serializeObject()),
                data: {'id':id},
                async:true, // 异步请求
                cache:false, // 设置为 false 将不缓存此页面
                dataType: "json", // 返回对象
                contentType:"application/json;charset=UTF-8",
                success: function(res) {
                    console.log("res.code=="+res.code);
                    console.log("res=="+JSON.stringify(res));
                    if (res.code == "0") {
                        layer.msg('删除成功！', {icon: 1});
                        $('#table').bootstrapTable("refresh");
                    }else {
                        layer.alert("["+res.code+"]"+res.msg, {
                            skin: 'layui-layer-lan'
                            ,closeBtn: 0
                            ,anim: 4 //动画类型
                        });
                    }
                },
                error: function(e) {
                    // 请求失败函数
                    console.log("error:"+JSON.stringify(e));
                }
            })
        }, function(){
            return;
        })
    }

    function deleteBatch() {
        var rows = $('#table').bootstrapTable("getSelections");
        var names = "";
        console.log("rows="+JSON.stringify(rows));
        if(rows == null || rows.length == 0){
            alert("请选中一行");
            return;
        }else{
            for(var i = 0; i<rows.length; i++){
                names += rows[i].username + ","
            }
            names = names.substring(0,names.length-1);
        }

        layer.confirm('确定删除['+names+']吗？哥们？', {
            btn: ['确定','再想想'] //按钮
        }, function(){
            $.ajax({
                type: "post",
                url: "deleteBatch",
                // data: JSON.stringify($('#form').serializeObject()),
                data:  JSON.stringify(rows),
                async:true, // 异步请求
                cache:false, // 设置为 false 将不缓存此页面
                dataType: "json", // 返回对象
                contentType:"application/json;charset=UTF-8",
                success: function(res) {
                    console.log("res.code=="+res.code);
                    console.log("res=="+JSON.stringify(res));
                    if (res.code == "0") {
                        layer.msg('删除成功！', {icon: 1});
                        $('#table').bootstrapTable("refresh");
                    }else {
                        layer.alert("["+res.code+"]"+res.msg, {
                            skin: 'layui-layer-lan'
                            ,closeBtn: 0
                            ,anim: 4 //动画类型
                        });
                    }
                },
                error: function(e) {
                    // 请求失败函数
                    console.log("error:"+JSON.stringify(e));
                }
            })
        }, function(){
            return;
        })
    }

    
    function queryData() {
        $('#table').bootstrapTable("refresh");
    }
    function warrant(){
        layer.open({
            type: 2,
            title: '角色授权',
            shadeClose: true,
            shade: 0.5,
            skin: 'layui-layer-rim',
            closeBtn:1,
            area: ['630px', '585px'],
            content: 'role_warrant.html'
        });
    }
</script>
</body>
</html>
